# gmain-agent ä¸­æ–‡ä½¿ç”¨æŒ‡å—

ä¸€ä¸ªç”Ÿäº§çº§çš„å¤š Agent AI ç¼–ç åŠ©æ‰‹ï¼Œå…·å¤‡é«˜çº§ä¸Šä¸‹æ–‡ç®¡ç†å’Œæ™ºèƒ½æƒé™æŽ§åˆ¶ã€‚

[![ç‰ˆæœ¬](https://img.shields.io/badge/version-0.3.0-blue.svg)](https://github.com/yourusername/gmain-agent)
[![Go](https://img.shields.io/badge/Go-1.21+-00ADD8?logo=go)](https://golang.org/)
[![è®¸å¯è¯](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒåŠŸèƒ½è¯¦è§£](#æ ¸å¿ƒåŠŸèƒ½è¯¦è§£)
  - [1. å¤š Agent ç³»ç»Ÿ](#1-å¤š-agent-ç³»ç»Ÿ)
  - [2. æƒé™ç®¡ç†](#2-æƒé™ç®¡ç†)
  - [3. ä¸Šä¸‹æ–‡ç®¡ç†](#3-ä¸Šä¸‹æ–‡ç®¡ç†)
  - [4. è®¡åˆ’æ¨¡å¼](#4-è®¡åˆ’æ¨¡å¼)
  - [5. ä»»åŠ¡å§”æ‰˜](#5-ä»»åŠ¡å§”æ‰˜)
- [å®žç”¨æŠ€å·§](#å®žç”¨æŠ€å·§)
- [æµ‹è¯•åœºæ™¯](#æµ‹è¯•åœºæ™¯)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/gmain-agent.git
cd gmain-agent

# ç¼–è¯‘å®‰è£…
go build -o ~/bin/gmain-agent ./cmd/claude

# æˆ–è€…ç›´æŽ¥å®‰è£…åˆ° $GOPATH/bin
go install ./cmd/claude
```

### é…ç½®

åˆ›å»ºé…ç½®æ–‡ä»¶ `~/.gmain-agent/config.yaml`ï¼š

```yaml
# Anthropic API é…ç½®
api_key: "sk-ant-api03-xxxxx"  # ä½ çš„ API Key
model: "claude-sonnet-4-20250514"
max_tokens: 8192

# å¯é€‰ï¼šè‡ªå®šä¹‰ API åœ°å€ï¼ˆå¦‚ä½¿ç”¨ä»£ç†ï¼‰
# base_url: "https://your-proxy.com"
```

### åŸºæœ¬ä½¿ç”¨

```bash
# äº¤äº’æ¨¡å¼
gmain-agent

# ç›´æŽ¥æ‰§è¡Œå‘½ä»¤
gmain-agent "åˆ†æžè¿™ä¸ªé¡¹ç›®çš„ä»£ç ç»“æž„"

# å¯ç”¨è¯¦ç»†æ—¥å¿—
gmain-agent --enable-logging

# æŸ¥çœ‹ç‰ˆæœ¬
gmain-agent --version
```

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. å¤š Agent ç³»ç»Ÿ

gmain-agent å†…ç½® 3 ä¸ªä¸“é—¨çš„ Agentï¼Œæ¯ä¸ªéƒ½æœ‰ä¸åŒçš„æƒé™å’Œç”¨é€”ã€‚

#### 1.1 Build Agentï¼ˆæž„å»ºæ¨¡å¼ï¼‰

**ç”¨é€”**ï¼šå®Œæ•´çš„å¼€å‘å·¥ä½œï¼Œå¯ä»¥è¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤

**æƒé™**ï¼š
- âœ… è¯»å–æ‰€æœ‰æ–‡ä»¶
- âœ… å†™å…¥/ç¼–è¾‘æ–‡ä»¶
- âœ… æ‰§è¡Œ bash å‘½ä»¤
- âœ… ä½¿ç”¨æ‰€æœ‰å·¥å…·

**ä½¿ç”¨åœºæ™¯**ï¼š
```bash
# å¯åŠ¨åŽé»˜è®¤å°±æ˜¯ build agent
gmain-agent

# ç¤ºä¾‹å¯¹è¯
You: å¸®æˆ‘åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨çš„ main.go
Assistant: [ä½¿ç”¨ write å·¥å…·åˆ›å»ºæ–‡ä»¶ï¼Œä½¿ç”¨ bash è¿è¡Œæµ‹è¯•]

You: ä¿®å¤è¿™ä¸ª bugï¼šxxxx
Assistant: [ä½¿ç”¨ read è¯»å–æ–‡ä»¶ï¼Œä½¿ç”¨ edit ä¿®å¤ï¼Œä½¿ç”¨ bash æµ‹è¯•]
```

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•æ–‡ä»¶æ“ä½œæƒé™
You: åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª test.txt æ–‡ä»¶ï¼Œå†…å®¹æ˜¯ "Hello World"

# æµ‹è¯•å‘½ä»¤æ‰§è¡Œæƒé™
You: æ‰§è¡Œ ls -la æŸ¥çœ‹å½“å‰ç›®å½•

# æµ‹è¯•ä»£ç ä¿®æ”¹æƒé™
You: æŠŠ README.md ç¬¬ä¸€è¡Œæ”¹æˆ "# æµ‹è¯•é¡¹ç›®"
```

#### 1.2 Plan Agentï¼ˆè®¡åˆ’æ¨¡å¼ï¼‰

**ç”¨é€”**ï¼šåˆ¶å®šå®žçŽ°è®¡åˆ’ï¼Œåªèƒ½è¯»å–ä»£ç å’Œç¼–è¾‘è®¡åˆ’æ–‡æ¡£

**æƒé™**ï¼š
- âœ… è¯»å–æ‰€æœ‰æ–‡ä»¶
- âœ… ä½¿ç”¨æœç´¢å·¥å…·ï¼ˆglob, grepï¼‰
- âœ… ç¼–è¾‘è®¡åˆ’æ–‡æ¡£ï¼ˆplan.mdï¼‰
- âŒ ä¸èƒ½ä¿®æ”¹ä»£ç æ–‡ä»¶
- âŒ ä¸èƒ½æ‰§è¡Œå‘½ä»¤

**åˆ‡æ¢æ–¹å¼**ï¼š
```bash
# AI ä¼šæ ¹æ®ä»»åŠ¡è‡ªåŠ¨å»ºè®®åˆ‡æ¢ï¼Œæˆ–è€…ä½ å¯ä»¥ç›´æŽ¥è¦æ±‚
You: è¯·å…ˆåˆ¶å®šä¸€ä¸ªå®žçŽ°è®¡åˆ’

# AI ä¼šä½¿ç”¨ plan_enter å·¥å…·åˆ‡æ¢åˆ° plan agent
Assistant: æ­£åœ¨åˆ‡æ¢åˆ°è®¡åˆ’æ¨¡å¼...
[ç³»ç»Ÿæç¤º] å·²åˆ‡æ¢åˆ° plan agent

# åœ¨è®¡åˆ’æ¨¡å¼ä¸‹ï¼ŒAI ä¼šï¼š
# 1. åˆ†æžä»£ç åº“
# 2. åˆ¶å®šè¯¦ç»†è®¡åˆ’
# 3. åˆ›å»º plan.md æ–‡ä»¶
# 4. ä½¿ç”¨ plan_exit åˆ‡æ¢å›ž build agent
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```bash
# åœºæ™¯1ï¼šå¤§åž‹åŠŸèƒ½å¼€å‘
You: æˆ‘æƒ³æ·»åŠ ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œè¯·å…ˆåˆ¶å®šè®¡åˆ’
Assistant: [åˆ‡æ¢åˆ° plan agent]
         [åˆ†æžçŽ°æœ‰ä»£ç ]
         [åˆ›å»º plan.md åŒ…å«å®žçŽ°æ­¥éª¤]
         [åˆ‡æ¢å›ž build agent]
         [æŒ‰è®¡åˆ’å®žæ–½]

# åœºæ™¯2ï¼šé‡æž„ä»£ç 
You: è¯·åˆ†æžè¿™ä¸ªæ¨¡å—çš„æž¶æž„ï¼Œæå‡ºé‡æž„å»ºè®®
Assistant: [è¿›å…¥è®¡åˆ’æ¨¡å¼åˆ†æž]
         [ç”Ÿæˆé‡æž„è®¡åˆ’]
         [å¾æ±‚ä½ çš„ç¡®è®¤]
```

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•åªè¯»æƒé™
You: è¿›å…¥è®¡åˆ’æ¨¡å¼ï¼Œç„¶åŽå°è¯•åˆ›å»ºä¸€ä¸ª test.go æ–‡ä»¶
Expected: AI ä¼šæç¤ºæƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºæ–‡ä»¶

# æµ‹è¯•è®¡åˆ’æ–‡æ¡£æƒé™
You: è¿›å…¥è®¡åˆ’æ¨¡å¼ï¼Œåˆ›å»ºä¸€ä¸ªå®žçŽ°è®¡åˆ’
Expected: AI å¯ä»¥æˆåŠŸåˆ›å»ºå’Œç¼–è¾‘ plan.md
```

#### 1.3 Explore Agentï¼ˆæŽ¢ç´¢å­ Agentï¼‰

**ç”¨é€”**ï¼šå¿«é€Ÿæœç´¢å’ŒæŽ¢ç´¢ä»£ç åº“ï¼ˆä½œä¸ºå­ä»»åŠ¡è°ƒç”¨ï¼‰

**æƒé™**ï¼š
- âœ… åªè¯»æƒé™
- âœ… å¿«é€Ÿæœç´¢
- âŒ ä¸èƒ½ä¿®æ”¹ä»»ä½•æ–‡ä»¶
- âš¡ æœ€å¤š 10 æ­¥æ“ä½œï¼ˆå¿«é€Ÿè¿”å›žï¼‰

**è‡ªåŠ¨è°ƒç”¨**ï¼š
```bash
# å½“ AI éœ€è¦æœç´¢ä»£ç æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ task å·¥å…·è°ƒç”¨ explore agent
You: æ‰¾å‡ºæ‰€æœ‰å¤„ç† HTTP è¯·æ±‚çš„ä»£ç 
Assistant: [è‡ªåŠ¨è°ƒç”¨ explore agent]
         [å¿«é€Ÿæœç´¢ç›¸å…³æ–‡ä»¶]
         [è¿”å›žæœç´¢ç»“æžœ]
         [ç»§ç»­ä¸»ä»»åŠ¡]
```

**æ‰‹åŠ¨è§¦å‘**ï¼ˆé€šè¿‡æè¿°ä»»åŠ¡ï¼‰ï¼š
```bash
You: å¿«é€Ÿæœç´¢ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®é‡Œæœ‰å“ªäº›é…ç½®æ–‡ä»¶
Assistant: [å¯èƒ½è°ƒç”¨ explore agent è¿›è¡Œå¿«é€Ÿæœç´¢]
```

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•å¿«é€Ÿæœç´¢èƒ½åŠ›
You: æ‰¾å‡ºé¡¹ç›®ä¸­æ‰€æœ‰çš„ TODO æ³¨é‡Š

# æµ‹è¯•åªè¯»é™åˆ¶
You: ä½¿ç”¨ explore agent æœç´¢å¹¶ä¿®æ”¹æ–‡ä»¶
Expected: explore agent åªèƒ½æœç´¢ï¼Œä¸èƒ½ä¿®æ”¹
```

#### 1.4 Agent å¯¹æ¯”è¡¨

| ç‰¹æ€§ | Build Agent | Plan Agent | Explore Agent |
|------|------------|------------|---------------|
| **ä½¿ç”¨åœºæ™¯** | æ—¥å¸¸å¼€å‘ | åˆ¶å®šè®¡åˆ’ | ä»£ç æœç´¢ |
| **è¯»å–æ–‡ä»¶** | âœ… | âœ… | âœ… |
| **å†™å…¥æ–‡ä»¶** | âœ… | âš ï¸ ä»… plan.md | âŒ |
| **æ‰§è¡Œå‘½ä»¤** | âœ… | âŒ | âŒ |
| **æœç´¢ä»£ç ** | âœ… | âœ… | âœ… |
| **æ“ä½œé™åˆ¶** | æ— é™åˆ¶ | åªè¯»+è®¡åˆ’ | æœ€å¤š10æ­¥ |
| **é¢œè‰²æ ‡è¯†** | ðŸ”µ è“è‰² | ðŸŸ£ ç´«è‰² | ðŸŸ¢ ç»¿è‰² |

### 2. æƒé™ç®¡ç†

gmain-agent ä½¿ç”¨åŸºäºŽè§„åˆ™çš„æƒé™ç³»ç»Ÿï¼Œæ¯ä¸ª Agent éƒ½æœ‰ç‹¬ç«‹çš„æƒé™é›†ã€‚

#### 2.1 æƒé™è§„åˆ™

**è§„åˆ™ç»“æž„**ï¼š
```go
Rule {
    Permission: "bash"           // å·¥å…·åç§°
    Pattern:    "rm -rf /"      // åŒ¹é…æ¨¡å¼ï¼ˆæ”¯æŒ globï¼‰
    Action:     ActionDeny       // åŠ¨ä½œï¼šAllow/Deny/Ask
}
```

**å†…ç½®æƒé™é…ç½®**ï¼š

**Build Agent æƒé™**ï¼š
```yaml
è¯»å–æ–‡ä»¶:
  - å…è®¸: æ‰€æœ‰æ–‡ä»¶ (*)

å†™å…¥æ–‡ä»¶:
  - å…è®¸: æ‰€æœ‰æ–‡ä»¶ (*)

æ‰§è¡Œå‘½ä»¤:
  - å…è®¸: å¤§éƒ¨åˆ†å‘½ä»¤
  - æ‹’ç»: rm -rf /
  - æ‹’ç»: dd if=/dev/zero
  - è¯¢é—®: rm * (å±é™©åˆ é™¤æ“ä½œ)
```

**Plan Agent æƒé™**ï¼š
```yaml
è¯»å–æ–‡ä»¶:
  - å…è®¸: æ‰€æœ‰æ–‡ä»¶

å†™å…¥æ–‡ä»¶:
  - å…è®¸: plan.md, *.plan.md
  - æ‹’ç»: å…¶ä»–æ‰€æœ‰æ–‡ä»¶

æ‰§è¡Œå‘½ä»¤:
  - æ‹’ç»: æ‰€æœ‰å‘½ä»¤
```

**Explore Agent æƒé™**ï¼š
```yaml
è¯»å–æ–‡ä»¶:
  - å…è®¸: æ‰€æœ‰æ–‡ä»¶ï¼ˆåªè¯»ï¼‰

å†™å…¥æ–‡ä»¶:
  - æ‹’ç»: æ‰€æœ‰æ–‡ä»¶

æ‰§è¡Œå‘½ä»¤:
  - æ‹’ç»: æ‰€æœ‰å‘½ä»¤
```

#### 2.2 æƒé™æµ‹è¯•

**æµ‹è¯•å±é™©å‘½ä»¤æ‹¦æˆª**ï¼š
```bash
You: æ‰§è¡Œå‘½ä»¤ rm -rf /
Expected: ç³»ç»Ÿæ‹’ç»ï¼Œæç¤ºæƒé™ä¸è¶³

You: æ‰§è¡Œå‘½ä»¤ rm *.txt
Expected: ç³»ç»Ÿè¯¢é—®ç¡®è®¤ï¼ˆå¦‚æžœé…ç½®äº† Askï¼‰
```

**æµ‹è¯•æ–‡ä»¶å†™å…¥æƒé™**ï¼š
```bash
# åœ¨ plan agent ä¸­æµ‹è¯•
You: åˆ‡æ¢åˆ°è®¡åˆ’æ¨¡å¼ï¼Œç„¶åŽåˆ›å»º test.go æ–‡ä»¶
Expected: æƒé™è¢«æ‹’ç»

You: åˆ‡æ¢åˆ°è®¡åˆ’æ¨¡å¼ï¼Œç„¶åŽåˆ›å»º plan.md æ–‡ä»¶
Expected: æˆåŠŸåˆ›å»º
```

**æµ‹è¯• glob æ¨¡å¼åŒ¹é…**ï¼š
```bash
# å¦‚æžœä½ è‡ªå®šä¹‰äº†æƒé™è§„åˆ™
Rule: {Permission: "write", Pattern: "*.go", Action: Allow}
Rule: {Permission: "write", Pattern: "*.txt", Action: Deny}

You: åˆ›å»º test.go æ–‡ä»¶
Expected: æˆåŠŸï¼ˆåŒ¹é… *.goï¼‰

You: åˆ›å»º test.txt æ–‡ä»¶
Expected: æ‹’ç»ï¼ˆåŒ¹é… *.txt æ‹’ç»è§„åˆ™ï¼‰
```

#### 2.3 Doom Loop æ£€æµ‹

**åŠŸèƒ½**ï¼šé˜²æ­¢ AI é™·å…¥æ— é™å¾ªçŽ¯ï¼ˆåŒä¸€ä¸ªå·¥å…·ç”¨ç›¸åŒå‚æ•°è¿žç»­è°ƒç”¨ 3 æ¬¡ä»¥ä¸Šï¼‰

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# è¿™æ˜¯å†…éƒ¨ä¿æŠ¤æœºåˆ¶ï¼Œæ­£å¸¸ä½¿ç”¨ä¸ä¼šè§¦å‘
# å¦‚æžœè§¦å‘ï¼Œä½ ä¼šçœ‹åˆ°ï¼š
Error: Potential infinite loop detected: tool 'read' called 3 times with same arguments
```

### 3. ä¸Šä¸‹æ–‡ç®¡ç†

gmain-agent å…·å¤‡æ™ºèƒ½ä¸Šä¸‹æ–‡åŽ‹ç¼©èƒ½åŠ›ï¼Œèƒ½åœ¨é•¿å¯¹è¯ä¸­ä¿æŒé«˜æ•ˆã€‚

#### 3.1 Token è¿½è¸ª

**å®žæ—¶æ˜¾ç¤º**ï¼š
```bash
# æ¯æ¬¡ API è°ƒç”¨åŽï¼Œç³»ç»Ÿä¼šæ˜¾ç¤º token ä½¿ç”¨æƒ…å†µ
You: åˆ†æžè¿™ä¸ªæ–‡ä»¶
Assistant: [è¯»å–å¹¶åˆ†æžæ–‡ä»¶...]
[ç³»ç»Ÿæ˜¾ç¤º] Tokens: Input=2340 (+500 cache) Output=420 [Total: 3260]
           â†‘           â†‘             â†‘              â†‘
        è¾“å…¥tokens  ç¼“å­˜è¯»å–    è¾“å‡ºtokens      æ€»è®¡
```

**Token å«ä¹‰**ï¼š
- **Input**: æœ¬æ¬¡è¯·æ±‚æ¶ˆè€—çš„è¾“å…¥ tokens
- **Cache**: ä»Ž prompt cache è¯»å–çš„ tokensï¼ˆæ›´ä¾¿å®œï¼‰
- **Output**: AI ç”Ÿæˆçš„è¾“å‡º tokens
- **Total**: ç´¯è®¡æ€» tokens

#### 3.2 è‡ªåŠ¨åŽ‹ç¼©

å½“ token ä½¿ç”¨è¶…è¿‡ **80% é˜ˆå€¼**æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è§¦å‘åŽ‹ç¼©ã€‚

**åŽ‹ç¼©ç­–ç•¥**ï¼ˆä¸¤é˜¶æ®µï¼‰ï¼š

**é˜¶æ®µ 1 - å¿«é€Ÿä¿®å‰ªï¼ˆPruningï¼‰**ï¼š
```bash
[ç³»ç»Ÿæ˜¾ç¤º] Context: Starting conversation compaction...
[ç³»ç»Ÿæ˜¾ç¤º] Context: Pruned 18 tool results (52340 chars)

# ä¿®å‰ªè§„åˆ™ï¼š
# - ä¿ç•™æœ€è¿‘ 2 è½®å¯¹è¯
# - ä¿®å‰ªæ—§çš„å·¥å…·è¾“å‡º
# - ä¿æŠ¤ç‰¹æ®Šå·¥å…·ï¼ˆplan_enter, plan_exitï¼‰
# - æœ€å°‘ä¿®å‰ª 20KB
```

**é˜¶æ®µ 2 - å®Œæ•´åŽ‹ç¼©ï¼ˆFull Compactionï¼‰**ï¼š
```bash
# å¦‚æžœä¿®å‰ªåŽä»ç„¶è¶…è¿‡é˜ˆå€¼ï¼Œæ‰§è¡Œå®Œæ•´åŽ‹ç¼©
[ç³»ç»Ÿæ˜¾ç¤º] Context: Starting conversation compaction...
[ç³»ç»Ÿæ˜¾ç¤º] Context: Compacted 28 messages into summary

# å®Œæ•´åŽ‹ç¼©è¿‡ç¨‹ï¼š
# 1. æå–éœ€è¦åŽ‹ç¼©çš„æ—§æ¶ˆæ¯
# 2. è°ƒç”¨ API ç”Ÿæˆä¼šè¯æ‘˜è¦
# 3. ç”¨æ‘˜è¦æ›¿æ¢æ—§æ¶ˆæ¯
# 4. ä¿ç•™æœ€è¿‘å¯¹è¯
```

**è§¦å‘æ¡ä»¶è®¡ç®—**ï¼š
```
å½“å‰ä½¿ç”¨ = Input + CacheRead + Output
å¯ç”¨ç©ºé—´ = 200K (ä¸Šä¸‹æ–‡é™åˆ¶) - 8K (è¾“å‡ºé¢„ç•™)
è§¦å‘é˜ˆå€¼ = å¯ç”¨ç©ºé—´ Ã— 80% = 153.6K

å½“ å½“å‰ä½¿ç”¨ > 153.6K æ—¶è§¦å‘åŽ‹ç¼©
```

#### 3.3 è¾“å‡ºæˆªæ–­

**åŠŸèƒ½**ï¼šå·¥å…·è¾“å‡ºè¶…è¿‡ 30KB è‡ªåŠ¨æˆªæ–­ï¼Œå®Œæ•´è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ã€‚

**ç¤ºä¾‹**ï¼š
```bash
You: æ‰§è¡Œ ls -laR é€’å½’åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
Assistant: [ä½¿ç”¨ bash å·¥å…·]
[å·¥å…·è¾“å‡ºéžå¸¸å¤§ï¼Œçº¦ 80KB]

[æ˜¾ç¤ºå‰ 30KB å†…å®¹]
...
... (output truncated, 50000 more characters) ...

Full output saved to: /tmp/gmain-agent/session-1736982340/outputs/bash-abc123.txt

# ä½ å¯ä»¥æŸ¥çœ‹å®Œæ•´è¾“å‡º
$ cat /tmp/gmain-agent/session-1736982340/outputs/bash-abc123.txt
```

**è¾“å‡ºç›®å½•ç»“æž„**ï¼š
```
/tmp/gmain-agent/
â””â”€â”€ session-1736982340/          # Session ID
    â””â”€â”€ outputs/
        â”œâ”€â”€ bash-abc123.txt      # bash å·¥å…·è¾“å‡º
        â”œâ”€â”€ read-def456.txt      # read å·¥å…·è¾“å‡º
        â””â”€â”€ grep-ghi789.txt      # grep å·¥å…·è¾“å‡º
```

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æµ‹è¯•å¤§è¾“å‡ºæˆªæ–­
You: æ‰§è¡Œå‘½ä»¤ find / -type f 2>/dev/null
Expected: è¾“å‡ºè¢«æˆªæ–­ï¼Œæç¤ºå®Œæ•´è¾“å‡ºä¿å­˜ä½ç½®

# æµ‹è¯•æ­£å¸¸è¾“å‡ºï¼ˆä¸æˆªæ–­ï¼‰
You: æ‰§è¡Œå‘½ä»¤ ls
Expected: æ­£å¸¸æ˜¾ç¤ºï¼Œä¸æˆªæ–­
```

### 4. è®¡åˆ’æ¨¡å¼

è®¡åˆ’æ¨¡å¼æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œæµç¨‹ï¼Œç”¨äºŽåˆ¶å®šå®žçŽ°è®¡åˆ’ã€‚

#### 4.1 å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â†“
AI åˆ¤æ–­éœ€è¦è®¡åˆ’
    â†“
ä½¿ç”¨ plan_enter å·¥å…· â†’ åˆ‡æ¢åˆ° Plan Agent
    â†“
Plan Agent å·¥ä½œï¼š
  1. åˆ†æžä»£ç åº“ï¼ˆread, grep, globï¼‰
  2. åˆ¶å®šè¯¦ç»†è®¡åˆ’
  3. åˆ›å»º plan.md æ–‡ä»¶
  4. åˆ—å‡ºå®žçŽ°æ­¥éª¤
    â†“
ä½¿ç”¨ plan_exit å·¥å…· â†’ åˆ‡æ¢å›ž Build Agent
    â†“
Build Agent æŒ‰è®¡åˆ’å®žæ–½
```

#### 4.2 ä½¿ç”¨ç¤ºä¾‹

**åœºæ™¯ 1ï¼šæ·»åŠ æ–°åŠŸèƒ½**

```bash
You: æˆ‘æƒ³æ·»åŠ ä¸€ä¸ªç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ³¨å†Œã€ç™»å½•ã€JWT token
Assistant: æˆ‘ç†è§£ä½ çš„éœ€æ±‚ã€‚è®©æˆ‘åˆ¶å®šä¸€ä¸ªå®žçŽ°è®¡åˆ’ã€‚
[ç³»ç»Ÿæ˜¾ç¤º] æ­£åœ¨åˆ‡æ¢åˆ° plan agent...
[ç³»ç»Ÿæ˜¾ç¤º] å·²åˆ‡æ¢åˆ° plan agent

Assistant (Plan Agent):
æˆ‘ä¼šå…ˆåˆ†æžçŽ°æœ‰é¡¹ç›®ç»“æž„ï¼Œç„¶åŽåˆ¶å®šè¯¦ç»†è®¡åˆ’ã€‚

[ä½¿ç”¨ glob æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶]
[ä½¿ç”¨ grep æœç´¢çŽ°æœ‰è®¤è¯ä»£ç ]
[ä½¿ç”¨ read é˜…è¯»å…³é”®æ–‡ä»¶]

[åˆ›å»º plan.md æ–‡ä»¶]

## ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®žçŽ°è®¡åˆ’

### 1. æ•°æ®åº“è®¾è®¡
- User è¡¨ï¼šid, username, email, password_hash, created_at
- Session è¡¨ï¼šid, user_id, token, expires_at

### 2. å®žçŽ°æ­¥éª¤
1. åˆ›å»ºç”¨æˆ·æ¨¡åž‹å’Œæ•°æ®åº“è¿ç§»
2. å®žçŽ°å¯†ç å“ˆå¸Œå‡½æ•°ï¼ˆä½¿ç”¨ bcryptï¼‰
3. å®žçŽ° JWT token ç”Ÿæˆå’ŒéªŒè¯
4. åˆ›å»ºæ³¨å†ŒæŽ¥å£ POST /api/register
5. åˆ›å»ºç™»å½•æŽ¥å£ POST /api/login
6. åˆ›å»ºè®¤è¯ä¸­é—´ä»¶
7. æ·»åŠ å•å…ƒæµ‹è¯•
8. é›†æˆæµ‹è¯•

### 3. éœ€è¦çš„ä¾èµ–åŒ…
- golang.org/x/crypto/bcrypt
- github.com/golang-jwt/jwt/v5

[ç³»ç»Ÿæ˜¾ç¤º] æ­£åœ¨åˆ‡æ¢å›ž build agent...
[ç³»ç»Ÿæ˜¾ç¤º] å·²åˆ‡æ¢åˆ° build agent

Assistant (Build Agent):
è®¡åˆ’å·²åˆ¶å®šå®Œæˆã€‚çŽ°åœ¨æˆ‘å°†æŒ‰ç…§è®¡åˆ’å¼€å§‹å®žæ–½...
[å¼€å§‹åˆ›å»ºæ–‡ä»¶å’Œç¼–å†™ä»£ç ]
```

**åœºæ™¯ 2ï¼šä»£ç é‡æž„**

```bash
You: è¿™ä¸ª user.go æ–‡ä»¶å¤ªé•¿äº†ï¼Œå¸®æˆ‘é‡æž„ä¸€ä¸‹
Assistant: è®©æˆ‘å…ˆåˆ†æžä»£ç ç»“æž„ï¼Œåˆ¶å®šé‡æž„è®¡åˆ’ã€‚
[åˆ‡æ¢åˆ° plan agent]
[åˆ†æž user.go æ–‡ä»¶]
[è¯†åˆ«å¯ä»¥æ‹†åˆ†çš„æ¨¡å—]
[åˆ›å»ºé‡æž„è®¡åˆ’]

## user.go é‡æž„è®¡åˆ’

### å½“å‰é—®é¢˜
- æ–‡ä»¶è¿‡é•¿ï¼ˆ500+ è¡Œï¼‰
- æ··åˆäº†å¤šä¸ªèŒè´£
- æµ‹è¯•å›°éš¾

### é‡æž„æ–¹æ¡ˆ
1. æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼š
   - user.go - æ ¸å¿ƒ User æ¨¡åž‹
   - user_repository.go - æ•°æ®åº“æ“ä½œ
   - user_service.go - ä¸šåŠ¡é€»è¾‘
   - user_handler.go - HTTP å¤„ç†å‡½æ•°

2. ä¿æŒæŽ¥å£å…¼å®¹æ€§
3. é€æ­¥è¿ç§»çŽ°æœ‰ä»£ç 

[åˆ‡æ¢å›ž build agent]
[æŒ‰è®¡åˆ’æ‰§è¡Œé‡æž„]
```

#### 4.3 plan.md æ–‡ä»¶ç¤ºä¾‹

å½“ Plan Agent å·¥ä½œæ—¶ï¼Œä¼šåˆ›å»ºç±»ä¼¼è¿™æ ·çš„è®¡åˆ’æ–‡ä»¶ï¼š

```markdown
# åŠŸèƒ½å®žçŽ°è®¡åˆ’

## ç›®æ ‡
æ·»åŠ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## å½“å‰åˆ†æž
- é¡¹ç›®ä½¿ç”¨ Gin æ¡†æž¶
- æ•°æ®åº“ä½¿ç”¨ PostgreSQL
- å·²æœ‰åŸºç¡€çš„ç”¨æˆ·æ¨¡åž‹
- ç¼ºå°‘è®¤è¯å’ŒæŽˆæƒæœºåˆ¶

## å®žçŽ°æ­¥éª¤

### Step 1: æ•°æ®åº“å‡†å¤‡
- [ ] æ›´æ–° User æ¨¡åž‹æ·»åŠ  password_hash å­—æ®µ
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] è¿è¡Œè¿ç§»

### Step 2: è®¤è¯åŠŸèƒ½
- [ ] å®žçŽ°å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰
- [ ] å®žçŽ° JWT token ç”Ÿæˆ
- [ ] å®žçŽ° token éªŒè¯ä¸­é—´ä»¶

### Step 3: API æŽ¥å£
- [ ] POST /api/auth/register - ç”¨æˆ·æ³¨å†Œ
- [ ] POST /api/auth/login - ç”¨æˆ·ç™»å½•
- [ ] POST /api/auth/logout - ç”¨æˆ·ç™»å‡º
- [ ] GET /api/auth/me - èŽ·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### Step 4: æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•ï¼šå¯†ç å“ˆå¸Œã€token ç”Ÿæˆ
- [ ] é›†æˆæµ‹è¯•ï¼šæ³¨å†Œã€ç™»å½•æµç¨‹
- [ ] æµ‹è¯•ä¸­é—´ä»¶è®¤è¯

## æŠ€æœ¯é€‰åž‹
- å¯†ç å“ˆå¸Œï¼šgolang.org/x/crypto/bcrypt
- JWT: github.com/golang-jwt/jwt/v5
- ä¼šè¯å­˜å‚¨ï¼šRedisï¼ˆå¯é€‰ï¼‰

## é£Žé™©å’Œæ³¨æ„äº‹é¡¹
- å¯†ç å¼ºåº¦éªŒè¯
- Token è¿‡æœŸæ—¶é—´è®¾ç½®ï¼ˆå»ºè®® 24hï¼‰
- HTTPS ä¼ è¾“
- CSRF é˜²æŠ¤
```

#### 4.4 æµ‹è¯•è®¡åˆ’æ¨¡å¼

```bash
# æµ‹è¯•è‡ªåŠ¨è¿›å…¥è®¡åˆ’æ¨¡å¼
You: æˆ‘æƒ³é‡æž„æ•´ä¸ªé¡¹ç›®æž¶æž„ï¼Œä»Ž MVC æ”¹æˆ DDD
Expected: AI å»ºè®®æˆ–è‡ªåŠ¨è¿›å…¥è®¡åˆ’æ¨¡å¼

# æµ‹è¯•æ‰‹åŠ¨è¿›å…¥è®¡åˆ’æ¨¡å¼
You: è¯·å…ˆåˆ¶å®šä¸€ä¸ªè¯¦ç»†çš„å®žçŽ°è®¡åˆ’
Expected: AI ä½¿ç”¨ plan_enter å·¥å…·åˆ‡æ¢

# æµ‹è¯•è®¡åˆ’æ–‡æ¡£ç”Ÿæˆ
You: [åœ¨è®¡åˆ’æ¨¡å¼ä¸­] åˆ†æžé¡¹ç›®å¹¶ç”Ÿæˆè®¡åˆ’
Expected: åˆ›å»º plan.md æ–‡ä»¶

# æµ‹è¯•è®¡åˆ’æ¨¡å¼æƒé™
You: [åœ¨è®¡åˆ’æ¨¡å¼ä¸­] åˆ›å»º main.go æ–‡ä»¶
Expected: æƒé™è¢«æ‹’ç»

# æµ‹è¯•é€€å‡ºè®¡åˆ’æ¨¡å¼
You: è®¡åˆ’åˆ¶å®šå®ŒæˆåŽ
Expected: AI è‡ªåŠ¨ä½¿ç”¨ plan_exit åˆ‡æ¢å›ž build agent
```

### 5. ä»»åŠ¡å§”æ‰˜

ä»»åŠ¡å§”æ‰˜å…è®¸ä¸» Agent è°ƒç”¨å­ Agent å®Œæˆç‰¹å®šä»»åŠ¡ã€‚

#### 5.1 å·¥ä½œåŽŸç†

```
Build/Plan Agent (ä¸» Agent)
         â†“
    ä½¿ç”¨ task å·¥å…·
         â†“
    Explore Agent (å­ Agent)
         â†“
    å¿«é€Ÿæœç´¢/åˆ†æž
         â†“
    è¿”å›žç»“æžœç»™ä¸» Agent
         â†“
    ä¸» Agent ç»§ç»­å·¥ä½œ
```

#### 5.2 ä½¿ç”¨åœºæ™¯

**åœºæ™¯ 1ï¼šä»£ç æœç´¢**
```bash
You: æ‰¾å‡ºæ‰€æœ‰ä½¿ç”¨äº† database è¿žæŽ¥çš„åœ°æ–¹

Assistant (Build Agent):
æˆ‘éœ€è¦æœç´¢ä»£ç åº“...
[ä½¿ç”¨ task å·¥å…·è°ƒç”¨ explore agent]

[Explore Agent å·¥ä½œ]
- æœç´¢ "database", "db.Connect", "sql.Open"
- åˆ†æžç»“æžœ
- è¿”å›žå‘çŽ°çš„æ–‡ä»¶å’Œä½ç½®

[Build Agent ç»§ç»­]
æˆ‘æ‰¾åˆ°äº†ä»¥ä¸‹ä½¿ç”¨æ•°æ®åº“è¿žæŽ¥çš„åœ°æ–¹ï¼š
1. internal/db/connection.go:23
2. cmd/server/main.go:45
3. internal/repository/user.go:12
...
```

**åœºæ™¯ 2ï¼šå¿«é€Ÿåˆ†æž**
```bash
You: è¿™ä¸ªé¡¹ç›®ç”¨äº†å“ªäº›ç¬¬ä¸‰æ–¹åº“ï¼Ÿ
Assistant: è®©æˆ‘å¿«é€Ÿåˆ†æžä¸€ä¸‹...
[è°ƒç”¨ explore agent]
[è¯»å– go.mod, package.json ç­‰ä¾èµ–æ–‡ä»¶]
[æœç´¢ import è¯­å¥]

æ‰¾åˆ°ä»¥ä¸‹ç¬¬ä¸‰æ–¹åº“ï¼š
- github.com/gin-gonic/gin (Web æ¡†æž¶)
- gorm.io/gorm (ORM)
- github.com/redis/go-redis (Redis å®¢æˆ·ç«¯)
...
```

#### 5.3 å­ Agent é™åˆ¶

- **æœ€å¤š 10 æ­¥**ï¼šå¿«é€Ÿè¿”å›žï¼Œé¿å…é•¿æ—¶é—´è¿è¡Œ
- **åªè¯»æƒé™**ï¼šä¸èƒ½ä¿®æ”¹æ–‡ä»¶
- **è‡ªåŠ¨è¶…æ—¶**ï¼šè¶…è¿‡é™åˆ¶è‡ªåŠ¨ç»“æŸ

#### 5.4 æµ‹è¯•ä»»åŠ¡å§”æ‰˜

```bash
# æµ‹è¯•å­ Agent è°ƒç”¨
You: æœç´¢é¡¹ç›®ä¸­æ‰€æœ‰çš„ TODO æ³¨é‡Š
Expected: å¯èƒ½è°ƒç”¨ explore agent å¿«é€Ÿæœç´¢

# æµ‹è¯•å­ Agent é™åˆ¶
You: è®© explore agent æœç´¢å¹¶ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶
Expected: explore agent åªèƒ½æœç´¢ï¼Œä¸èƒ½ä¿®æ”¹

# æµ‹è¯•å¿«é€Ÿè¿”å›ž
You: åˆ†æžæ•´ä¸ª Linux å†…æ ¸æºç 
Expected: explore agent ä¼šåœ¨ 10 æ­¥å†…è¿”å›žéƒ¨åˆ†ç»“æžœ
```

## å®žç”¨æŠ€å·§

### æŠ€å·§ 1ï¼šé•¿æ—¶é—´å¯¹è¯ç®¡ç†

```bash
# ç³»ç»Ÿä¼šè‡ªåŠ¨åŽ‹ç¼©ä¸Šä¸‹æ–‡ï¼Œä½†ä½ å¯ä»¥ä¸»åŠ¨æ¸…ç†

# æŸ¥çœ‹å½“å‰ token ä½¿ç”¨
# æ¯æ¬¡æ“ä½œåŽéƒ½ä¼šæ˜¾ç¤º

# æ‰‹åŠ¨æ¸…ç†ä¼šè¯ï¼ˆå¦‚æžœéœ€è¦ï¼‰
You: /clear
```

### æŠ€å·§ 2ï¼šæ‰¹é‡æ“ä½œ

```bash
# è®© AI ä¸€æ¬¡å¤„ç†å¤šä¸ªæ–‡ä»¶
You: ç»™ internal/models/ ç›®å½•ä¸‹çš„æ‰€æœ‰ Go æ–‡ä»¶æ·»åŠ æ³¨é‡Š

# AI ä¼šï¼š
# 1. ä½¿ç”¨ glob æ‰¾åˆ°æ‰€æœ‰æ–‡ä»¶
# 2. éåŽ†æ¯ä¸ªæ–‡ä»¶
# 3. æ·»åŠ æ³¨é‡Š
# 4. æ˜¾ç¤ºè¿›åº¦
```

### æŠ€å·§ 3ï¼šä»£ç å®¡æŸ¥

```bash
You: å®¡æŸ¥ user.go æ–‡ä»¶ï¼Œæ‰¾å‡ºæ½œåœ¨é—®é¢˜

# AI ä¼šï¼š
# 1. è¯»å–æ–‡ä»¶
# 2. åˆ†æžä»£ç è´¨é‡
# 3. æŒ‡å‡ºé—®é¢˜ï¼ˆå®‰å…¨æ¼æ´žã€æ€§èƒ½é—®é¢˜ã€æœ€ä½³å®žè·µç­‰ï¼‰
# 4. å»ºè®®æ”¹è¿›æ–¹æ¡ˆ
```

### æŠ€å·§ 4ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘

```bash
You: ä¸º user_service.go çš„ CreateUser å‡½æ•°å†™æµ‹è¯•ç”¨ä¾‹

# AI ä¼šï¼š
# 1. è¯»å–æºä»£ç 
# 2. ç†è§£å‡½æ•°é€»è¾‘
# 3. ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ˆæ­£å¸¸ã€è¾¹ç•Œã€å¼‚å¸¸æƒ…å†µï¼‰
# 4. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
```

### æŠ€å·§ 5ï¼šäº¤äº’å¼è°ƒè¯•

```bash
You: è¿è¡Œæµ‹è¯•å¹¶ä¿®å¤å¤±è´¥çš„ç”¨ä¾‹

# AI ä¼šï¼š
# 1. æ‰§è¡Œ go test
# 2. æŸ¥çœ‹å¤±è´¥è¾“å‡º
# 3. åˆ†æžå¤±è´¥åŽŸå› 
# 4. ä¿®å¤ä»£ç 
# 5. é‡æ–°è¿è¡Œæµ‹è¯•
# 6. å¾ªçŽ¯ç›´åˆ°å…¨éƒ¨é€šè¿‡
```

### æŠ€å·§ 6ï¼šä½¿ç”¨æ—¥å¿—è°ƒè¯•

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
$ gmain-agent --enable-logging

# æ—¥å¿—ä½ç½®
/tmp/claude-agent-*.log

# æŸ¥çœ‹æ—¥å¿—
$ tail -f /tmp/claude-agent-*.log

# æ—¥å¿—åŒ…å«ï¼š
# - API è¯·æ±‚/å“åº”
# - å·¥å…·è°ƒç”¨è¯¦æƒ…
# - Token ä½¿ç”¨ç»Ÿè®¡
# - é”™è¯¯ä¿¡æ¯
```

### æŠ€å·§ 7ï¼šæ€§èƒ½ä¼˜åŒ–å¯¹è¯

```bash
You: åˆ†æžè¿™ä¸ªå‡½æ•°çš„æ€§èƒ½ç“¶é¢ˆå¹¶ä¼˜åŒ–

# AI ä¼šï¼š
# 1. è¯»å–ä»£ç 
# 2. è¯†åˆ«æ€§èƒ½é—®é¢˜ï¼ˆå¾ªçŽ¯ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰
# 3. å»ºè®®ä¼˜åŒ–æ–¹æ¡ˆ
# 4. å®žæ–½ä¼˜åŒ–
# 5. å¯ä»¥å»ºè®®æ·»åŠ  benchmark æµ‹è¯•
```

## æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šå®Œæ•´åŠŸèƒ½å¼€å‘

```bash
# ç›®æ ‡ï¼šä»Žé›¶å¼€å‘ä¸€ä¸ª RESTful API

You: åˆ›å»ºä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿ APIï¼ŒåŒ…æ‹¬ï¼š
     - å›¾ä¹¦çš„ CRUD æ“ä½œ
     - SQLite æ•°æ®åº“
     - RESTful æŽ¥å£
     - å•å…ƒæµ‹è¯•

# AI å·¥ä½œæµç¨‹ï¼š
Step 1: [å¯èƒ½è¿›å…¥è®¡åˆ’æ¨¡å¼]
        åˆ†æžéœ€æ±‚ï¼Œåˆ¶å®šè®¡åˆ’

Step 2: [Build Agent]
        åˆ›å»ºé¡¹ç›®ç»“æž„
        - main.go
        - internal/models/book.go
        - internal/handlers/book_handler.go
        - internal/db/database.go

Step 3: å®žçŽ°æ•°æ®åº“å±‚
        - å®šä¹‰ Book æ¨¡åž‹
        - å®žçŽ°æ•°æ®åº“è¿žæŽ¥
        - å®žçŽ° CRUD æ“ä½œ

Step 4: å®žçŽ° API å±‚
        - è·¯ç”±è®¾ç½®
        - Handler å‡½æ•°
        - é”™è¯¯å¤„ç†

Step 5: ç¼–å†™æµ‹è¯•
        - å•å…ƒæµ‹è¯•
        - API é›†æˆæµ‹è¯•

Step 6: è¿è¡Œå’ŒéªŒè¯
        - go test ./...
        - ä¿®å¤é—®é¢˜
        - å®Œæˆ

# æµ‹è¯•é‡ç‚¹ï¼š
- âœ… å¤š Agent åä½œï¼ˆplan + buildï¼‰
- âœ… æ–‡ä»¶æ“ä½œæƒé™
- âœ… å‘½ä»¤æ‰§è¡Œ
- âœ… é”™è¯¯å¤„ç†
- âœ… è‡ªåŠ¨é‡è¯•ï¼ˆå¦‚æžœç½‘ç»œé—®é¢˜ï¼‰
```

### åœºæ™¯ 2ï¼šä»£ç é‡æž„

```bash
# ç›®æ ‡ï¼šé‡æž„æ··ä¹±çš„ä»£ç 

You: è¿™ä¸ª service.go æ–‡ä»¶æœ‰ 800 è¡Œï¼Œå¤ªä¹±äº†ï¼Œå¸®æˆ‘é‡æž„

# AI å·¥ä½œæµç¨‹ï¼š
Step 1: [Plan Agent]
        åˆ†æžä»£ç ç»“æž„
        è¯†åˆ«å¯æ‹†åˆ†çš„æ¨¡å—
        åˆ¶å®šé‡æž„è®¡åˆ’

Step 2: [Build Agent]
        æŒ‰è®¡åˆ’æ‹†åˆ†æ–‡ä»¶
        - service.go
        - service_user.go
        - service_product.go
        - service_order.go

Step 3: è¿ç§»ä»£ç 
        ä¿æŒæŽ¥å£å…¼å®¹
        æ›´æ–°å¯¼å…¥

Step 4: æµ‹è¯•
        ç¡®ä¿åŠŸèƒ½ä¸å˜

# æµ‹è¯•é‡ç‚¹ï¼š
- âœ… è®¡åˆ’æ¨¡å¼ä½¿ç”¨
- âœ… å¤§è§„æ¨¡æ–‡ä»¶æ“ä½œ
- âœ… ä»£ç åˆ†æžèƒ½åŠ›
```

### åœºæ™¯ 3ï¼šBug ä¿®å¤

```bash
# ç›®æ ‡ï¼šå®šä½å¹¶ä¿®å¤ bug

You: ç”¨æˆ·æŠ¥å‘Šç™»å½•æŽ¥å£è¿”å›ž 500 é”™è¯¯

# AI å·¥ä½œæµç¨‹ï¼š
Step 1: æœç´¢ç›¸å…³ä»£ç 
        [å¯èƒ½è°ƒç”¨ explore agent]
        æ‰¾åˆ°ç™»å½•ç›¸å…³æ–‡ä»¶

Step 2: åˆ†æžä»£ç 
        è¯»å– handler, service, repository

Step 3: è¯†åˆ«é—®é¢˜
        å‘çŽ°æœªå¤„ç†çš„ç©ºæŒ‡é’ˆ

Step 4: ä¿®å¤
        æ·»åŠ ç©ºå€¼æ£€æŸ¥
        æ”¹è¿›é”™è¯¯å¤„ç†

Step 5: æµ‹è¯•
        è¿è¡Œæµ‹è¯•ç¡®è®¤ä¿®å¤

# æµ‹è¯•é‡ç‚¹ï¼š
- âœ… ä»£ç æœç´¢ï¼ˆexplore agentï¼‰
- âœ… é—®é¢˜å®šä½
- âœ… æµ‹è¯•éªŒè¯
```

### åœºæ™¯ 4ï¼šåŽ‹åŠ›æµ‹è¯•ä¸Šä¸‹æ–‡ç®¡ç†

```bash
# ç›®æ ‡ï¼šæµ‹è¯•é•¿å¯¹è¯ä¸­çš„ä¸Šä¸‹æ–‡åŽ‹ç¼©

# æ–¹æ³•ï¼šè¿žç»­æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œè§‚å¯Ÿ token ä½¿ç”¨å’ŒåŽ‹ç¼©

You: è¯»å– file1.go
[ç³»ç»Ÿ] Tokens: Input=1200 Output=300 [Total: 1500]

You: è¯»å– file2.go
[ç³»ç»Ÿ] Tokens: Input=2400 Output=600 [Total: 3000]

You: è¯»å– file3.go
... æŒç»­æ“ä½œ ...

[å½“ token > 80% é˜ˆå€¼æ—¶]
[ç³»ç»Ÿ] Context: Starting conversation compaction...
[ç³»ç»Ÿ] Context: Pruned 15 tool results (45230 chars)

# éªŒè¯ï¼š
- âœ… Token ç»Ÿè®¡å‡†ç¡®
- âœ… è‡ªåŠ¨è§¦å‘åŽ‹ç¼©
- âœ… åŽ‹ç¼©åŽå¯ç»§ç»­å¯¹è¯
- âœ… åŽ†å²ä¸Šä¸‹æ–‡ä¿ç•™åˆç†
```

### åœºæ™¯ 5ï¼šæƒé™æµ‹è¯•

```bash
# ç›®æ ‡ï¼šæµ‹è¯•æƒé™ç³»ç»Ÿ

# Test 1: æµ‹è¯•å±é™©å‘½ä»¤æ‹¦æˆª
You: æ‰§è¡Œ rm -rf /
Expected: æ‹’ç»

# Test 2: æµ‹è¯• Plan Agent é™åˆ¶
You: è¿›å…¥è®¡åˆ’æ¨¡å¼
You: åˆ›å»º main.go æ–‡ä»¶
Expected: æƒé™ä¸è¶³

# Test 3: æµ‹è¯• Explore Agent é™åˆ¶
You: æœç´¢ä»£ç å¹¶ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶
Expected: åªèƒ½æœç´¢ï¼Œä¸èƒ½ä¿®æ”¹

# éªŒè¯ï¼š
- âœ… å±é™©æ“ä½œè¢«æ‹¦æˆª
- âœ… Agent æƒé™æ­£ç¡®ç”Ÿæ•ˆ
- âœ… é”™è¯¯æç¤ºæ¸…æ™°
```

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ¸…ç©ºå¯¹è¯åŽ†å²ï¼Ÿ

```bash
You: /clear

# æˆ–è€…é‡å¯ç¨‹åº
Ctrl+C é€€å‡º
gmain-agent é‡æ–°å¯åŠ¨
```

### Q2: Token ä½¿ç”¨è¿‡å¿«æ€Žä¹ˆåŠžï¼Ÿ

**åŽŸå› **ï¼š
- è¾“å‡ºè¿‡å¤§ï¼ˆå¦‚å¤§æ–‡ä»¶å†…å®¹ï¼‰
- é¢‘ç¹å·¥å…·è°ƒç”¨
- å¤æ‚å¯¹è¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç³»ç»Ÿä¼šè‡ªåŠ¨åŽ‹ç¼©ï¼ˆ80% é˜ˆå€¼ï¼‰
2. å¤§è¾“å‡ºä¼šè‡ªåŠ¨æˆªæ–­ï¼ˆ30KBï¼‰
3. ä½¿ç”¨æ›´ç²¾ç¡®çš„æŒ‡ä»¤å‡å°‘è¯•æŽ¢

### Q3: å¦‚ä½•æŸ¥çœ‹å®Œæ•´çš„å·¥å…·è¾“å‡ºï¼Ÿ

```bash
# å½“è¾“å‡ºè¢«æˆªæ–­æ—¶ï¼Œä¼šæç¤ºå®Œæ•´æ–‡ä»¶ä½ç½®
... (output truncated) ...
Full output saved to: /tmp/gmain-agent/session-xxx/outputs/bash-abc.txt

# æŸ¥çœ‹å®Œæ•´è¾“å‡º
$ cat /tmp/gmain-agent/session-xxx/outputs/bash-abc.txt
```

### Q4: AI æƒé™ä¸è¶³æ€Žä¹ˆåŠžï¼Ÿ

**æ£€æŸ¥å½“å‰ Agent**ï¼š
```bash
# ç³»ç»Ÿä¼šæ˜¾ç¤ºå½“å‰ Agent
[ç³»ç»Ÿ] å·²åˆ‡æ¢åˆ° plan agent

# Plan Agent ä¸èƒ½ä¿®æ”¹ä»£ç ï¼Œéœ€è¦åˆ‡æ¢å›ž Build Agent
You: åˆ‡æ¢å›žæ­£å¸¸æ¨¡å¼
æˆ–è€…ï¼šç›´æŽ¥è¦æ±‚å®žæ–½
```

### Q5: å¦‚ä½•è®© AI æ›´å¥½åœ°ç†è§£éœ€æ±‚ï¼Ÿ

**æŠ€å·§**ï¼š
1. æä¾›å…·ä½“ç¤ºä¾‹
2. æŒ‡å®šæŠ€æœ¯æ ˆå’Œçº¦æŸ
3. åˆ†æ­¥éª¤æè¿°
4. æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```bash
# âŒ æ¨¡ç³Š
You: åšä¸€ä¸ªç”¨æˆ·ç³»ç»Ÿ

# âœ… æ¸…æ™°
You: åˆ›å»ºç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œè¦æ±‚ï¼š
     - ä½¿ç”¨ JWT token
     - PostgreSQL æ•°æ®åº“
     - Gin æ¡†æž¶
     - åŒ…å«æ³¨å†Œã€ç™»å½•ã€ç™»å‡ºæŽ¥å£
     - æ·»åŠ å•å…ƒæµ‹è¯•
```

### Q6: é•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤å¦‚ä½•å¤„ç†ï¼Ÿ

```bash
# ä½¿ç”¨åŽå°è¿è¡Œ
You: å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆåŽå°è¿è¡Œï¼‰

# AI ä¼šä½¿ç”¨ run_in_background: true
# æˆ–è€…åœ¨å‘½ä»¤åŽæ·»åŠ  &
go run main.go &
```

### Q7: å¦‚ä½•è°ƒè¯• AI çš„è¡Œä¸ºï¼Ÿ

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
gmain-agent --enable-logging

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f /tmp/claude-agent-*.log

# æ—¥å¿—åŒ…å«ï¼š
# - æ¯ä¸ªå·¥å…·è°ƒç”¨
# - API è¯·æ±‚/å“åº”
# - Token ä½¿ç”¨
# - é”™è¯¯è¯¦æƒ…
```

### Q8: å¦‚ä½•æé«˜å“åº”é€Ÿåº¦ï¼Ÿ

**å»ºè®®**ï¼š
1. ç²¾ç¡®æè¿°éœ€æ±‚ï¼ˆå‡å°‘è¯•æŽ¢ï¼‰
2. é¿å…ä¸€æ¬¡æ€§å¤„ç†å¤§é‡æ–‡ä»¶
3. ä½¿ç”¨ explore agent è¿›è¡Œå¿«é€Ÿæœç´¢
4. åˆ©ç”¨è®¡åˆ’æ¨¡å¼ï¼ˆå…ˆè§„åˆ’å†æ‰§è¡Œï¼‰

### Q9: å¦‚ä½•å¤„ç†ç½‘ç»œé”™è¯¯ï¼Ÿ

gmain-agent å†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼š
- è‡ªåŠ¨é‡è¯•ç½‘ç»œé”™è¯¯ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- æŒ‡æ•°é€€é¿ï¼ˆ500ms â†’ 1s â†’ 2sï¼‰
- è§£æž HTTP Retry-After å¤´
- ç”¨æˆ·æ— æ„ŸçŸ¥

### Q10: å¦‚ä½•éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Ÿ

å‚è€ƒæœ¬æ–‡æ¡£çš„ [æµ‹è¯•åœºæ™¯](#æµ‹è¯•åœºæ™¯) éƒ¨åˆ†ï¼Œä¾æ¬¡æµ‹è¯•ï¼š
1. åŸºæœ¬æ–‡ä»¶æ“ä½œ
2. Agent åˆ‡æ¢
3. æƒé™é™åˆ¶
4. ä¸Šä¸‹æ–‡ç®¡ç†
5. è®¡åˆ’æ¨¡å¼
6. ä»»åŠ¡å§”æ‰˜

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰æƒé™è§„åˆ™

ç›®å‰æƒé™è§„åˆ™å†…ç½®åœ¨ä»£ç ä¸­ï¼Œæœªæ¥ç‰ˆæœ¬å°†æ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰ã€‚

### è‡ªå®šä¹‰ Agent

å¯ä»¥é€šè¿‡ä¿®æ”¹ `internal/agentregistry/builtin.go` æ·»åŠ è‡ªå®šä¹‰ Agentã€‚

### æ€§èƒ½è°ƒä¼˜

```yaml
# config.yaml
max_tokens: 16384  # å¢žåŠ è¾“å‡ºé•¿åº¦ï¼ˆå¦‚éœ€è¦ï¼‰
model: "claude-sonnet-4-20250514"  # ä½¿ç”¨ä¸åŒæ¨¡åž‹
```

## é¡¹ç›®ä¿¡æ¯

### ä»£ç ç»Ÿè®¡

- **æ€»ä»£ç è¡Œæ•°**: ~6,400 è¡Œ
- **Go æ–‡ä»¶**: 35+
- **æ–‡æ¡£**: 8 ä¸ª Markdown æ–‡ä»¶
- **ç¤ºä¾‹ç¨‹åº**: 3 ä¸ª

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.21+
- **AI Model**: Claude Sonnet 4.5
- **ä¾èµ–**: æœ€å°åŒ–ï¼ˆä¸»è¦ä½¿ç”¨æ ‡å‡†åº“ï¼‰

### ç‰ˆæœ¬åŽ†å²

- **v0.3.0** (2026-01-16): ä¸Šä¸‹æ–‡ç®¡ç† + æ™ºèƒ½é‡è¯•
- **v0.2.0** (2026-01-16): å¤š Agent ç³»ç»Ÿ + æƒé™ç®¡ç†
- **v0.1.0** (2026-01-15): åˆå§‹ç‰ˆæœ¬

## èŽ·å–å¸®åŠ©

- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yourusername/gmain-agent/issues)
- **åŠŸèƒ½è®¨è®º**: [GitHub Discussions](https://github.com/yourusername/gmain-agent/discussions)
- **æ–‡æ¡£**: æŸ¥çœ‹ `docs/` ç›®å½•

## ç›¸å…³æ–‡æ¡£

- [FEATURES.md](FEATURES.md) - è¯¦ç»†åŠŸèƒ½è¯´æ˜Ž
- [PHASE3_COMPLETE.md](PHASE3_COMPLETE.md) - Phase 3 å®žçŽ°æ€»ç»“
- [INTEGRATION_SUMMARY.md](INTEGRATION_SUMMARY.md) - é›†æˆæ€»ç»“
- [DESIGN_ANALYSIS.md](DESIGN_ANALYSIS.md) - æž¶æž„åˆ†æž

---

**å¼€å§‹ä½¿ç”¨**

```bash
# å®‰è£…
go install ./cmd/claude

# é…ç½®
cat > ~/.gmain-agent/config.yaml << EOF
api_key: "your-api-key"
model: "claude-sonnet-4-20250514"
max_tokens: 8192
EOF

# è¿è¡Œ
gmain-agent

# æµ‹è¯•
You: åˆ›å»ºä¸€ä¸ª hello.go æ–‡ä»¶ï¼Œè¾“å‡º "Hello, World!"
```

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ðŸš€
